<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Pelanggaran SMAN 1 Magetan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .gradient-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        .logo-container {
            width: 65px;
            height: 65px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .form-input {
            width: 100%;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            outline: none;
            transition: all 0.2s;
        }

        .form-input:focus {
            border-color: #3b82f6;
            ring: 2px;
            ring-color: #3b82f6;
        }
    </style>
</head>
<body class="min-h-screen pb-12">

    <!-- Header -->
    <header class="gradient-header text-white py-6 px-6 shadow-lg mb-8">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-5">
                <div class="logo-container">
                    <img src="https://smasa-magetan.sch.id/wp-content/uploads/2023/06/LOGO-SMA-NEGERI-1-MAGETAN.png" 
                         alt="Logo SMAN 1 Magetan" 
                         onerror="this.src='https://via.placeholder.com/70?text=SMASA'"
                         class="w-full h-full object-contain p-1">
                </div>
                <div>
                    <h1 class="text-2xl font-extrabold tracking-tight uppercase">SMAN 1 MAGETAN</h1>
                    <p class="text-blue-100 text-sm flex items-center gap-2 font-medium">
                        <i class="fas fa-check-shield text-xs"></i>
                        E-Pelanggaran: Sistem Disiplin Digital
                    </p>
                </div>
            </div>
            <div class="text-right flex flex-col items-end">
                <div id="liveClock" class="font-semibold text-lg"></div>
                <div class="flex gap-2 mt-2">
                    <button onclick="switchTab('dashboard')" class="bg-white/10 hover:bg-white/20 px-4 py-1.5 rounded-full text-xs transition border border-white/30">
                        <i class="fas fa-chart-line mr-1"></i> Dashboard
                    </button>
                    <button onclick="switchTab('rules')" class="bg-white/10 hover:bg-white/20 px-4 py-1.5 rounded-full text-xs transition border border-white/30">
                        <i class="fas fa-book mr-1"></i> Aturan & Tata Tertib
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4">
        
        <!-- Tab: Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Kolom Kiri: Form Input Pelanggaran -->
                <section class="lg:col-span-1">
                    <div class="glass-card rounded-2xl p-6 shadow-sm sticky top-8 border-t-4 border-blue-600">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <i class="fas fa-edit text-blue-600"></i>
                                Form Pelanggaran
                            </h2>
                            <span class="text-[10px] bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold">MODE INPUT</span>
                        </div>
                        
                        <form id="violationForm" class="space-y-4">
                            <!-- Tanggal Kejadian -->
                            <div>
                                <label class="form-label">Tanggal Kejadian</label>
                                <input type="date" id="eventDate" required class="form-input">
                            </div>

                            <!-- Nama Siswa -->
                            <div>
                                <label class="form-label">Nama Siswa</label>
                                <input type="text" id="studentName" required placeholder="Cari nama siswa..." class="form-input">
                            </div>

                            <!-- Kelas -->
                            <div>
                                <label class="form-label">Kelas</label>
                                <select id="studentClass" required class="form-input">
                                    <option value="">Pilih Kelas</option>
                                    <optgroup label="Kelas X">
                                        <option value="X-1">X-1</option><option value="X-2">X-2</option><option value="X-3">X-3</option>
                                    </optgroup>
                                    <optgroup label="Kelas XI">
                                        <option value="XI-MIPA-1">XI-MIPA-1</option><option value="XI-MIPA-2">XI-MIPA-2</option><option value="XI-IPS-1">XI-IPS-1</option>
                                    </optgroup>
                                    <optgroup label="Kelas XII">
                                        <option value="XII-MIPA-1">XII-MIPA-1</option><option value="XII-IPS-1">XII-IPS-1</option>
                                    </optgroup>
                                </select>
                            </div>

                            <!-- Jenis Pelanggaran -->
                            <div>
                                <label class="form-label">Jenis Pelanggaran</label>
                                <select id="violationType" required class="form-input">
                                    <option value="" data-points="0">Pilih Jenis</option>
                                    <option value="Terlambat Masuk Sekolah" data-points="5">Terlambat Masuk (5 Poin)</option>
                                    <option value="Tidak Mengikuti Pelajaran (Bolos)" data-points="15">Bolos Pelajaran (15 Poin)</option>
                                    <option value="Lolos / Keluar Area Sekolah" data-points="20">Lolos/Keluar Sekolah (20 Poin)</option>
                                    <option value="Merokok di Area Sekolah" data-points="50">Merokok (50 Poin)</option>
                                    <option value="Tidak Mengikuti Upacara" data-points="10">Tidak Upacara (10 Poin)</option>
                                    <option value="Atribut Tidak Lengkap" data-points="5">Atribut Tidak Lengkap (5 Poin)</option>
                                    <option value="Berkelahi / Tawuran" data-points="100">Berkelahi (100 Poin)</option>
                                </select>
                            </div>

                            <!-- Nama Pelapor -->
                            <div>
                                <label class="form-label">Guru Pelapor</label>
                                <input type="text" id="reporterName" required placeholder="Nama guru yang melaporkan..." class="form-input">
                            </div>

                            <!-- Keterangan Tambahan -->
                            <div>
                                <label class="form-label">Keterangan / Kronologi</label>
                                <textarea id="description" rows="3" placeholder="Tambahkan detail singkat jika perlu..." class="form-input text-sm"></textarea>
                            </div>

                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md hover:shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2">
                                <i class="fas fa-save"></i>
                                Simpan Data
                            </button>
                        </form>
                    </div>
                </section>

                <!-- Kolom Kanan: Daftar & Statistik -->
                <section class="lg:col-span-2 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="glass-card p-4 rounded-xl border-l-4 border-blue-500 shadow-sm">
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Total Laporan</p>
                            <p id="statTotal" class="text-3xl font-extrabold text-gray-800">0</p>
                        </div>
                        <div class="glass-card p-4 rounded-xl border-l-4 border-orange-500 shadow-sm">
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Poin Tertinggi</p>
                            <p id="statMaxPoints" class="text-3xl font-extrabold text-gray-800">0</p>
                        </div>
                        <div class="glass-card p-4 rounded-xl border-l-4 border-red-500 shadow-sm">
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Kasus Berat</p>
                            <p id="statSevere" class="text-3xl font-extrabold text-gray-800">0</p>
                        </div>
                    </div>

                    <div class="glass-card rounded-2xl shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-gray-100 flex flex-col md:flex-row justify-between items-center gap-4">
                            <h2 class="text-xl font-bold text-gray-800">Log Pelanggaran Siswa</h2>
                            <div class="relative w-full md:w-64">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="searchInput" placeholder="Cari siswa/kelas..." 
                                    class="w-full pl-10 pr-4 py-2 rounded-full bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm transition">
                            </div>
                        </div>

                        <div class="overflow-x-auto custom-scrollbar max-h-[600px]">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-gray-50 text-gray-600 text-xs sticky top-0 z-10">
                                    <tr>
                                        <th class="px-6 py-4 font-bold uppercase">Kejadian</th>
                                        <th class="px-6 py-4 font-bold uppercase">Siswa</th>
                                        <th class="px-6 py-4 font-bold uppercase">Pelanggaran</th>
                                        <th class="px-6 py-4 font-bold uppercase text-center">Poin</th>
                                        <th class="px-6 py-4 font-bold uppercase text-center">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="violationList" class="divide-y divide-gray-100"></tbody>
                            </table>
                            <div id="emptyState" class="p-16 text-center text-gray-400 hidden">
                                <i class="fas fa-folder-open text-5xl mb-4 opacity-20"></i>
                                <p class="font-medium">Data masih kosong.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Tab: Rules (Aturan & Tata Tertib) -->
        <div id="rules" class="tab-content">
            <!-- ... (Sama seperti versi sebelumnya) ... -->
            <div class="max-w-4xl mx-auto space-y-6">
                <div class="glass-card rounded-2xl p-8 border-t-4 border-blue-800">
                    <h2 class="text-2xl font-bold text-blue-900 mb-6 flex items-center gap-3">
                        <i class="fas fa-gavel"></i>
                        Poin Pelanggaran & Sanksi SMAN 1 Magetan
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                        <div>
                            <h3 class="font-bold text-gray-800 border-b pb-2 mb-4">Kategori Ringan (5-10 Poin)</h3>
                            <ul class="space-y-2 text-sm text-gray-600">
                                <li class="flex justify-between"><span>Terlambat masuk sekolah</span> <span class="font-bold text-blue-600">5 Poin</span></li>
                                <li class="flex justify-between"><span>Atribut seragam tidak lengkap</span> <span class="font-bold text-blue-600">5 Poin</span></li>
                                <li class="flex justify-between"><span>Rambut tidak rapi/warna</span> <span class="font-bold text-blue-600">10 Poin</span></li>
                                <li class="flex justify-between"><span>Tidak mengikuti upacara</span> <span class="font-bold text-blue-600">10 Poin</span></li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 border-b pb-2 mb-4">Kategori Sedang (15-25 Poin)</h3>
                            <ul class="space-y-2 text-sm text-gray-600">
                                <li class="flex justify-between"><span>Bolos jam pelajaran</span> <span class="font-bold text-orange-600">15 Poin</span></li>
                                <li class="flex justify-between"><span>Lolos/Lari dari sekolah</span> <span class="font-bold text-orange-600">20 Poin</span></li>
                                <li class="flex justify-between"><span>Membawa HP saat jam belajar</span> <span class="font-bold text-orange-600">20 Poin</span></li>
                            </ul>
                        </div>
                    </div>

                    <div class="bg-red-50 p-6 rounded-xl border border-red-100 mb-8">
                        <h3 class="font-bold text-red-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-exclamation-triangle"></i>
                            Kategori Berat (50-100 Poin)
                        </h3>
                        <ul class="space-y-3 text-sm text-red-700">
                            <li class="flex justify-between items-center">
                                <span>Merokok di area/seragam sekolah</span>
                                <span class="bg-red-200 px-3 py-1 rounded font-bold text-xs">50 Poin</span>
                            </li>
                            <li class="flex justify-between items-center">
                                <span>Pelecehan/Bullying</span>
                                <span class="bg-red-200 px-3 py-1 rounded font-bold text-xs">75 Poin</span>
                            </li>
                            <li class="flex justify-between items-center">
                                <span>Berkelahi, Miras, atau Narkoba</span>
                                <span class="bg-red-200 px-3 py-1 rounded font-bold text-xs">100 Poin</span>
                            </li>
                        </ul>
                    </div>

                    <div class="border-t pt-6">
                        <h3 class="font-bold text-gray-800 mb-4">Tindak Lanjut Akumulasi Poin</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-gray-50 p-3 rounded text-center border">
                                <p class="text-[10px] font-bold text-gray-400">25 POIN</p>
                                <p class="text-xs font-semibold text-gray-700">Pembinaan Wali Kelas</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded text-center border">
                                <p class="text-[10px] font-bold text-gray-400">50 POIN</p>
                                <p class="text-xs font-semibold text-gray-700">Panggilan Orang Tua I</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded text-center border">
                                <p class="text-[10px] font-bold text-gray-400">75 POIN</p>
                                <p class="text-xs font-semibold text-gray-700">Skorsing & SP III</p>
                            </div>
                            <div class="bg-red-600 p-3 rounded text-center text-white">
                                <p class="text-[10px] font-bold opacity-80">100 POIN</p>
                                <p class="text-xs font-bold uppercase">Dikembalikan ke OT</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notifikasi Floating -->
    <div id="notification" class="fixed bottom-6 right-6 translate-y-20 opacity-0 transition-all duration-300 z-50">
        <div class="bg-gray-900 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 border border-gray-700">
            <i id="notifIcon" class="fas fa-check-circle text-green-400"></i>
            <span id="notifMessage" class="text-sm font-medium">Berhasil!</span>
        </div>
    </div>

    <script>
	const GAS_URL = "https://script.google.com/macros/s/AKfycbyT6T8B4s--tDHQSkE04PEpeYG7POPsSLgv1qo50uRg5IhCWp3ltYZNHi3_GobHzRsTkw/exec";

        // Set Default Date to Today
        document.getElementById('eventDate').valueAsDate = new Date();

        // Data Handling
        let violations = JSON.parse(localStorage.getItem('sman1magetan_violations')) || [];

        const form = document.getElementById('violationForm');
        const listContainer = document.getElementById('violationList');
        const emptyState = document.getElementById('emptyState');
        const searchInput = document.getElementById('searchInput');

        // Navigation
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        // Main Loop
        updateClock();
        setInterval(updateClock, 1000);
        renderData();

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const date = document.getElementById('eventDate').value;
            const name = document.getElementById('studentName').value;
            const sClass = document.getElementById('studentClass').value;
            const typeSelect = document.getElementById('violationType');
            const type = typeSelect.value;
            const points = parseInt(typeSelect.options[typeSelect.selectedIndex].getAttribute('data-points'));
            const reporter = document.getElementById('reporterName').value;
            const desc = document.getElementById('description').value;
            
            const newViolation = {
                id: Date.now(),
                date,
                name,
                class: sClass,
                type,
                points,
                reporter,
                desc,
                timestamp: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })
            };

          fetch(GAS_URL, {
    method: "POST",
    headers: {
        "Content-Type": "application/json"
    },
    body: JSON.stringify(newViolation)
})
.then(res => res.json())
.then(result => {
    if (result.status === "success") {
        showNotification("Laporan pelanggaran berhasil disimpan!");
        form.reset();
        document.getElementById('eventDate').valueAsDate = new Date();
        document.getElementById('reporterName').value = reporter;
    } else {
        showNotification("Gagal menyimpan data", "orange");
    }
})
.catch(err => {
    console.error(err);
    showNotification("Koneksi ke server gagal", "orange");
});

            
            // Reset form but keep reporter name for convenience
            const currentReporter = reporter;
            form.reset();
            document.getElementById('eventDate').valueAsDate = new Date();
            document.getElementById('reporterName').value = currentReporter;
            
            showNotification("Laporan pelanggaran berhasil disimpan!");
        });

        searchInput.addEventListener('input', (e) => {
            renderData(e.target.value);
        });

        function renderData(query = "") {
            listContainer.innerHTML = '';
            const filtered = violations.filter(v => 
                v.name.toLowerCase().includes(query.toLowerCase()) || 
                v.class.toLowerCase().includes(query.toLowerCase()) ||
                v.type.toLowerCase().includes(query.toLowerCase())
            );

            if (filtered.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                filtered.forEach(v => {
                    const row = document.createElement('tr');
                    row.className = "hover:bg-blue-50/50 transition-colors group cursor-help";
                    row.title = `Pelapor: ${v.reporter}\nKeterangan: ${v.desc || '-'}`;
                    row.innerHTML = `
                        <td class="px-6 py-4">
                            <div class="text-[10px] font-bold text-gray-400 uppercase">${new Date(v.date).toLocaleDateString('id-ID', {day:'numeric', month:'short'})}</div>
                            <div class="text-xs text-gray-500">${v.timestamp}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-bold text-gray-800">${v.name}</div>
                            <div class="text-[10px] font-bold text-blue-500 uppercase tracking-tighter">${v.class}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm text-gray-700 leading-tight">${v.type}</div>
                            <div class="text-[9px] text-gray-400">Oleh: ${v.reporter}</div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="inline-block px-3 py-1 rounded-lg ${getPoinColor(v.points)} font-bold text-xs min-w-[35px]">
                                ${v.points}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <button onclick="deleteEntry(${v.id})" class="text-gray-300 hover:text-red-500 transition-all transform hover:scale-110">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    listContainer.appendChild(row);
                });
            }
            updateStats();
        }

        function getPoinColor(p) {
            if (p >= 50) return "bg-red-50 text-red-600 border border-red-200";
            if (p >= 20) return "bg-orange-50 text-orange-600 border border-orange-200";
            return "bg-blue-50 text-blue-600 border border-blue-200";
        }

        function deleteEntry(id) {
            if(confirm("Hapus catatan pelanggaran ini? Tindakan ini tidak dapat dibatalkan.")) {
                violations = violations.filter(v => v.id !== id);
                saveData();
                renderData();
                showNotification("Catatan dihapus", "orange");
            }
        }

        function updateStats() {
            document.getElementById('statTotal').innerText = violations.length;
            const max = violations.length > 0 ? Math.max(...violations.map(v => v.points)) : 0;
            document.getElementById('statMaxPoints').innerText = max;
            const severe = violations.filter(v => v.points >= 50).length;
            document.getElementById('statSevere').innerText = severe;
        }

        function saveData() {
            localStorage.setItem('sman1magetan_violations', JSON.stringify(violations));
        }

        function updateClock() {
            const now = new Date();
            const options = { weekday: 'long', day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit' };
            document.getElementById('liveClock').innerText = now.toLocaleDateString('id-ID', options);
        }

        function showNotification(msg, color = "green") {
            const notif = document.getElementById('notification');
            const icon = document.getElementById('notifIcon');
            document.getElementById('notifMessage').innerText = msg;
            icon.className = color === "green" ? "fas fa-check-circle text-green-400" : "fas fa-exclamation-triangle text-orange-400";
            notif.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => notif.classList.add('translate-y-20', 'opacity-0'), 3000);
        }
    </script>
</body>
</html>